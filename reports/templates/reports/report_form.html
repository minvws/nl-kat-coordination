{% extends "layouts/base.html" %}

{% load i18n %}
{% load static %}

{% block content %}
    {% include "header.html" %}

    <main id="main-content">
        <section>
            <div class="introduction">
                <div>
                    <h1>{% translate "Generate New Report" %}</h1>
                    <p>
                        {% blocktranslate trimmed %}
                            Configure and generate a new security report. Select the organizations, finding types, and other filters to customize your report.
                        {% endblocktranslate %}
                    </p>
                </div>
            </div>
            <form method="post">
                {% csrf_token %}
                <input type="hidden" name="current_url" value="{{ request.get_full_path }}">
                {% if form.errors %}
                    <div class="error-list">
                        {% for field in form %}
                            {% for error in field.errors %}<p class="error">{{ field.label }}: {{ error }}</p>{% endfor %}
                        {% endfor %}
                        {% for error in form.non_field_errors %}<p class="error">{{ error }}</p>{% endfor %}
                    </div>
                {% endif %}
                <fieldset>
                    <legend>{% translate "Report Configuration" %}</legend>
                    <div class="form-group">
                        <label for="{{ form.name.id_for_label }}">{{ form.name.label }}</label>
                        {{ form.name }}
                        {% if form.name.help_text %}<p class="help-text">{{ form.name.help_text }}</p>{% endif %}
                    </div>
                    <div class="form-group">
                        <label for="{{ form.description.id_for_label }}">{{ form.description.label }}</label>
                        {{ form.description }}
                        {% if form.description.help_text %}<p class="help-text">{{ form.description.help_text }}</p>{% endif %}
                    </div>
                </fieldset>
                <fieldset>
                    <legend>{% translate "Report Filters" %}</legend>
                    <div class="form-group">
                        <label for="{{ form.organizations.id_for_label }}">{{ form.organizations.label }}</label>
                        {{ form.organizations }}
                        {% if form.organizations.help_text %}
                            <p class="help-text">{{ form.organizations.help_text }}</p>
                        {% else %}
                            <p class="help-text">{% translate "Leave empty to include all organizations you have access to." %}</p>
                        {% endif %}
                    </div>
                    <div class="form-group">
                        <label for="{{ form.finding_types.id_for_label }}">{{ form.finding_types.label }}</label>
                        {{ form.finding_types }}
                        {% if form.finding_types.help_text %}
                            <p class="help-text">{{ form.finding_types.help_text }}</p>
                        {% else %}
                            <p class="help-text">{% translate "Leave empty to include all finding types." %}</p>
                        {% endif %}
                    </div>
                    <div class="form-group">
                        <label for="{{ form.minimum_risk_score.id_for_label }}">{{ form.minimum_risk_score.label }}</label>
                        {{ form.minimum_risk_score }}
                        {% if form.minimum_risk_score.help_text %}
                            <p class="help-text">{{ form.minimum_risk_score.help_text }}</p>
                        {% else %}
                            <p class="help-text">
                                {% translate "Only include findings with a risk score equal to or higher than this value (0.0 - 10.0)." %}
                            </p>
                        {% endif %}
                    </div>
                    <div class="form-group">
                        <label for="{{ form.object_set.id_for_label }}">{{ form.object_set.label }}</label>
                        {{ form.object_set }}
                        {% if form.object_set.help_text %}
                            <p class="help-text">{{ form.object_set.help_text }}</p>
                        {% else %}
                            <p class="help-text">{% translate "Optionally select an object set to limit the report to specific assets." %}</p>
                        {% endif %}
                    </div>
                </fieldset>
                <div class="button-container">
                    <button type="submit" class="button">
                        <span class="icon ti-file-text"></span>{% translate "Generate Report" %}
                    </button>
                    <a href="{% url 'report_list' %}" class="button ghost">{% translate "Cancel" %}</a>
                </div>
            </form>
        </section>
    </main>
{% endblock content %}
