{% load i18n %}
{% load ooi_extra %}

<div class="horizontal-scroll">
    <table>
        <caption class="visually-hidden">{% translate "Other findings found" %}</caption>
        <thead>
            <tr>
                <th scope="col">{% translate "Risk level" %}</th>
                <th scope="col">{% translate "Finding types" %}</th>
                <th scope="col">{% translate "Occurrences" %}</th>
                <th scope="col">{% translate "First known occurrence" %}</th>
                {% if not is_dashboard %}
                    <th scope="col" class="visually-hidden actions">{% translate "Details" %}</th>
                {% endif %}
            </tr>
        </thead>
        <tbody>
            {% for info in finding_types %}
                <tr>
                    <td>
                        <span class="{{ info.finding_type.risk_severity }}">{{ info.finding_type.risk_severity|capfirst }}</span>
                    </td>
                    <td>{{ info.finding_type.id }}</td>
                    <td>{{ info.occurrences|length }}</td>
                    <td>{{ info.occurrences|get_first_seen }}</td>
                    {% if not is_dashboard %}
                        <td class="actions sticky-cell">
                            <button class="expando-button"
                                    data-icon-open-class="icon ti-chevron-down"
                                    data-icon-close-class="icon ti-chevron-up"
                                    data-close-label="{% translate "Close details" %}">
                                {% translate "Open details" %}
                            </button>
                        </td>
                    {% endif %}
                </tr>
                {% if not is_dashboard %}
                    <tr class="expando-row">
                        <td colspan="5">
                            <h4 class="heading-normal">{% translate "Description" %}</h4>
                            <p>{{ info.finding_type.description }}</p>
                            <h4 class="heading-normal">{% translate "Source" %}</h4>
                            {% if info.finding_type.source %}
                                <a href="{{ info.finding_type.source }}">{{ info.finding_type.source }}</a>
                            {% else %}
                                <p>{{ info.finding_type.source }}</p>
                            {% endif %}
                            <h4 class="heading-normal">{% translate "Impact" %}</h4>
                            <p>{{ info.finding_type.impact }}</p>
                            <h4 class="heading-normal">{% translate "Recommendation" %}</h4>
                            <p>{{ info.finding_type.recommendation }}</p>
                            <h4 class="heading-normal">{% translate "Findings" %}</h4>
                            <table class="nowrap">
                                <caption class="visually-hidden">{% translate "Findings overview" %}</caption>
                                <thead>
                                    <tr>
                                        <th scope="col">{% translate "Finding" %}</th>
                                        <th scope="col">{% translate "First known occurrence" %}</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for occurrence in info.occurrences %}
                                        <tr>
                                            <td>
                                                <a href="{% ooi_url 'ooi_detail' occurrence.finding.ooi organization.code %}">{{ occurrence.finding.ooi|human_readable }}</a>
                                            </td>
                                            <td>{{ occurrence.first_seen|get_date }}</td>
                                        </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </td>
                    </tr>
                {% endif %}
            {% endfor %}
        </tbody>
    </table>
</div>
