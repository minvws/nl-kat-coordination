{% load i18n %}
{% load ooi_extra %}

{% if show_introduction %}
    <p>
        {% blocktranslate trimmed %}
            The Findings Report provides an overview of the identified findings on the scanned
            systems. For each finding it shows the risk level and the number of occurrences of
            the finding. Under the 'Details' section a description, impact, recommendation and
            location of the finding can be found. The risk level may be different for your
            specific environment.
        {% endblocktranslate %}
    </p>
{% endif %}
{% if is_dashboard %}
    <div class="horizontal-scroll">
        <table>
            <caption class="visually-hidden">{% translate "Findings per organization overview" %}</caption>
            <thead>
                <tr>
                    <th>{% translate "Organization" %}</th>
                    <th scope="col">{% translate "Finding types" %}</th>
                    <th scope="col">{% translate "Occurrences" %}</th>
                    <th scope="col">{% translate "Highest risk level" %}</th>
                    <th scope="col">{% translate "Critical finding types" %}</th>
                    <th scope="col" class="visually-hidden actions">{% translate "Details" %}</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>{{ organization.name }}</td>
                    <td>
                        {% if data.summary.total_finding_types %}
                            {{ data.summary.total_finding_types }}
                        {% else %}
                            -
                        {% endif %}
                    </td>
                    <td>
                        {% if data.summary.total_occurrences %}
                            {{ data.summary.total_occurrences }}
                        {% else %}
                            -
                        {% endif %}
                    </td>
                    <td>
                        {% if data.finding_types.0.finding_type.risk_severity %}
                            <span class="{{ findings.finding_types.0.finding_type.risk_severity }}">{{ data.finding_types.0.finding_type.risk_severity|capfirst }}</span>
                        {% else %}
                            -
                        {% endif %}
                    </td>
                    <td>
                        {% if data.summary.total_by_severity_per_finding_type.critical %}
                            {{ data.summary.total_by_severity_per_finding_type.critical }}
                        {% else %}
                            -
                        {% endif %}
                    </td>
                    <td class="actions">
                        {% if data %}
                            <button class="expando-button"
                                    data-icon-open-class="icon ti-chevron-down"
                                    data-icon-close-class="icon ti-chevron-up"
                                    data-close-label="{% translate "Close details" %}">
                                {% translate "Open details" %}
                            </button>
                        {% endif %}
                    </td>
                </tr>
                {% if data %}
                    <tr class="expando-row">
                        <td>
                            <h4>{% translate "Findings overview" %}</h4>
                            {% include "partials/report_severity_totals_table.html" with data=data.summary %}

                            <h4>{% translate "Findings" %}</h4>
                            {% include "partials/report_findings_table.html" with finding_types=data.finding_types %}

                        </td>
                    </tr>
                {% endif %}
            </tbody>
        </table>
    </div>
{% else %}
    <div class="horizontal-scroll">
        <h3>{% translate "Findings overview" %}</h3>
        {% include "partials/report_severity_totals_table.html" with data=data.summary %}

        <h3>{% translate "Findings" %}</h3>
        {% include "partials/report_findings_table.html" with finding_types=data.finding_types %}

    </div>
{% endif %}
