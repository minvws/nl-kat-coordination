{% extends "layouts/base.html" %}

{% load i18n %}
{% load static %}

{% block content %}
    {% include "header.html" with view_type="onboarding" %}

    <main id="main-content">
        <section>
            <div>
                <h1>{% translate "OpenKAT Introduction" %}</h1>
                {% include "partials/stepper.html" %}

                <h2>{% translate "Setup scan - User clearance level" %}</h2>
                <p>
                    {% blocktranslate trimmed %}
                        OpenKAT uses clearance levels to indicate which users can start what type of scans. There are two types of clearance levels: 'Trusted' and 'Accepted' clearance levels.
                    {% endblocktranslate %}
                </p>
                <h3>{% translate "Trusted clearance level" %}</h3>
                <p>
                    {% blocktranslate trimmed %}
                        Trusted clearance levels are given by the administrator to indicate up to what level of scans the user can perform. A higher trusted clearance level means that more aggressive scans can be started.
                    {% endblocktranslate %}
                </p>
                <h3>{% translate "Acknowledge clearance level" %}</h3>
                <p>
                    {% blocktranslate trimmed %}
                        The user has to accept the provided clearance level before he can change setings or perform actions. The user can also choose to accept a lower lower clearance level than given by the administrator. By accepting the clearance level the user formally agrees to abide by this permission and perform scans up to this accepted clearance level.
                    {% endblocktranslate %}
                </p>
                <h3>{% translate "What is my clearance level?" %}</h3>
                {% with tcl=organization_member.trusted_clearance_level acl=organization_member.acknowledged_clearance_level %}
                    {% if tcl < dns_report_least_clearance_level or tcl < 0 %}
                        <p>
                            {% blocktranslate trimmed %}
                                Unfortunately you cannot continue the onboarding.
                            </br>
                            Your administrator has trusted you with a clearance level of <strong>L{{ tcl }}</strong>.
                        </br>
                        You need at least a clearance level of <strong>L{{ dns_report_least_clearance_level }}</strong> to scan <strong>{{ ooi }}</strong>
                    </br>
                    Contact your administrator to receive a higher clearance.
                {% endblocktranslate %}
            </p>
            <a href="{% url "complete_onboarding" organization.code %}"
               class="button ghost">{% translate "Skip onboarding" %}</a>
        {% elif tcl != acl %}
            <p>
                {% blocktranslate trimmed %}
                    Your administrator has trusted you with a clearance level of <strong>L{{ tcl }}</strong>.
                </br>
                You must first accept this clearance level to continue.
            {% endblocktranslate %}
        </p>
        {% blocktranslate asvar btn_text_accept_tcl trimmed %}
            Accept level L{{ tcl }} clearance and responsibility
        {% endblocktranslate %}
        {% include "partials/single_action_form.html" with btn_text=btn_text_accept_tcl action="accept_clearance" key="member_id" value=member.id btn_class="button" %}

        <a href="{% url "complete_onboarding" organization.code %}"
           class="button ghost">{% translate "Skip onboarding" %}</a>
    {% else %}
        <p>
            {% blocktranslate trimmed %}
                Your administrator has <strong>trusted</strong> you with a clearance level of <strong>L{{ tcl }}</strong>.
            </br>
            You have also <strong>acknowledged</strong> to use this clearance level of <strong>L{{ acl }}</strong>.
        {% endblocktranslate %}
    </p>
    <div class="button-container">
        <a href="{% url "step_set_clearance_level" organization.code %}?{{ request.GET.urlencode }}"
           class="button">{% translate "Set clearance level" %}</a>
        <a href="{% url "complete_onboarding" organization.code %}"
           class="button ghost">{% translate "Skip onboarding" %}</a>
    </div>
{% endif %}
{% endwith %}
</div>
</section>
</main>
{% endblock content %}
