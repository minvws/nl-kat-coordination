from typing import List
from unittest import TestCase

from boefjes.plugins.kat_cve_2023_35078.normalize import check_for_versions
from packaging import version


class CVE_2023_35078Test(TestCase):
    maxDiff = None

    PATCHED_VERSIONS: List[str] = ["11.10.0.2", "11.9.1.1", "11.8.1.1"]

    def test_vulnerable_version_11_8(self):
        detected_version = [version.parse("11.8.0.0")]
        patched_versions = [version.parse(v) for v in self.PATCHED_VERSIONS]
        self.assertTrue(check_for_versions(patched_versions, detected_version))

    def test_vulnerable_version_11_9(self):
        detected_version = [version.parse("11.9.1.0")]
        patched_versions = [version.parse(v) for v in self.PATCHED_VERSIONS]
        self.assertTrue(check_for_versions(patched_versions, detected_version))

    def test_vulnerable_version_11_10(self):
        detected_version = [version.parse("11.10.0.1")]
        patched_versions = [version.parse(v) for v in self.PATCHED_VERSIONS]
        self.assertTrue(check_for_versions(patched_versions, detected_version))

    def test_patched_version(self):
        detected_version = [version.parse("11.9.2.0")]
        patched_versions = [version.parse(v) for v in self.PATCHED_VERSIONS]
        self.assertFalse(check_for_versions(patched_versions, detected_version))

    def test_equal_to_patched_version(self):
        detected_version = [version.parse("11.9.1.1")]
        patched_versions = [version.parse(v) for v in self.PATCHED_VERSIONS]
        self.assertFalse(check_for_versions(patched_versions, detected_version))
