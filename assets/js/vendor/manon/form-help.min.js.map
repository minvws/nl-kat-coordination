{"version":3,"file":"form-help.min.js","sources":["../../src/js/form-help.js","../../src/js/utils.js"],"sourcesContent":["// @ts-check\n\nimport { ensureElementHasId, onDomReady, onDomUpdate } from \"./utils.js\";\n\nonDomReady(initFormHelp);\nonDomUpdate(initFormHelp);\n\n/**\n * Collapse collapsible explanations. Safe to call again to collapse newly\n * added collapsible explanations.\n */\nexport function initFormHelp() {\n\tfindCollapsibleExplanations().forEach(collapseExplanation);\n}\n\n/**\n * @return {HTMLElement[]}\n */\nfunction findCollapsibleExplanations() {\n\tvar result = [];\n\tvar explanations = document.querySelectorAll(\n\t\t\"form.help div input + .explanation,\" +\n\t\t\t\"form.help div textarea + .explanation,\" +\n\t\t\t\"form.help div select + .explanation,\" +\n\t\t\t\"form.help div div + .explanation,\" +\n\t\t\t\"form.help div label + .explanation,\" +\n\t\t\t\"form.help fieldset input + .explanation,\" +\n\t\t\t\"form.help fieldset textarea + .explanation,\" +\n\t\t\t\"form.help fieldset select + .explanation,\" +\n\t\t\t\"form.help fieldset div + .explanation,\" +\n\t\t\t\"form.help fieldset label + .explanation\"\n\t);\n\tfor (var i = 0; i < explanations.length; i++) {\n\t\tvar explanation = explanations[i];\n\t\tif (!(explanation instanceof HTMLElement)) {\n\t\t\tcontinue;\n\t\t}\n\t\tvar previousSibling = explanation.previousElementSibling;\n\t\tif (!(previousSibling instanceof HTMLElement)) {\n\t\t\tcontinue;\n\t\t}\n\t\tif (\n\t\t\tpreviousSibling.tagName === \"DIV\" &&\n\t\t\t!previousSibling.querySelector(\"input, textarea, select\")\n\t\t) {\n\t\t\tcontinue;\n\t\t}\n\t\tvar nextSibling = explanation.nextElementSibling;\n\t\tif (\n\t\t\t!(nextSibling instanceof HTMLElement) ||\n\t\t\tnextSibling.tagName !== \"BUTTON\" ||\n\t\t\t!nextSibling.classList.contains(\"help-button\")\n\t\t) {\n\t\t\tresult.push(explanation);\n\t\t}\n\t}\n\treturn result;\n}\n\n/**\n * @param {HTMLElement} explanation\n */\nfunction collapseExplanation(explanation) {\n\t// Start out collapsed\n\texplanation.classList.add(\"collapsed\");\n\n\t// Ensure the .explanation can receive focus and can be targeted via aria-controls\n\texplanation.tabIndex = -1;\n\tensureElementHasId(explanation);\n\n\t// Set up the button as an aria-expanded control for the .explanation\n\tvar button = document.createElement(\"button\");\n\tvar openLabel = explanation.dataset.openLabel || \"Open uitleg\";\n\tvar closeLabel = explanation.dataset.closeLabel || \"Sluit uitleg\";\n\tvar iconOpenClasses = (\n\t\texplanation.dataset.iconOpenClass || \"icon icon-questionmark\"\n\t).split(/\\s+/);\n\tvar iconCloseClasses = (\n\t\texplanation.dataset.iconCloseClass || \"icon icon-close\"\n\t).split(/\\s+/);\n\n\tbutton.classList.add(\"help-button\");\n\tbutton.classList.add.apply(button.classList, iconOpenClasses);\n\tbutton.type = \"button\";\n\tbutton.setAttribute(\"aria-expanded\", \"false\");\n\tbutton.setAttribute(\"aria-controls\", explanation.id);\n\tbutton.innerText = openLabel;\n\tbutton.addEventListener(\"click\", function toggleExpanded() {\n\t\tvar expand = button.getAttribute(\"aria-expanded\") === \"false\";\n\t\tbutton.setAttribute(\"aria-expanded\", expand ? \"true\" : \"false\");\n\t\tbutton.classList.remove.apply(\n\t\t\tbutton.classList,\n\t\t\texpand ? iconOpenClasses : iconCloseClasses\n\t\t);\n\t\tbutton.classList.add.apply(\n\t\t\tbutton.classList,\n\t\t\texpand ? iconCloseClasses : iconOpenClasses\n\t\t);\n\t\tbutton.innerText = expand ? closeLabel : openLabel;\n\t\tif (expand) {\n\t\t\texplanation.classList.remove(\"collapsed\");\n\t\t\texplanation.focus();\n\t\t} else {\n\t\t\texplanation.classList.add(\"collapsed\");\n\t\t}\n\t});\n\n\t// Insert the button after the .explanation\n\tif (explanation.nextSibling) {\n\t\texplanation.parentNode.insertBefore(button, explanation.nextSibling);\n\t} else {\n\t\texplanation.parentNode.append(button);\n\t}\n}\n","/**\n * Run the given callback function once after the DOM is ready.\n *\n * @param {() => void} fn\n */\nexport function onDomReady(fn) {\n\tif (document.readyState !== \"loading\") return fn();\n\tdocument.addEventListener(\"DOMContentLoaded\", fn);\n}\n\n/**\n * Provide the given element with a unique generated `id`, if it does not have one already.\n *\n * @param {HTMLElement} element\n */\nexport function ensureElementHasId(element) {\n\tif (!element.id) {\n\t\telement.id =\n\t\t\telement.tagName + \"-\" + (~~(Math.random() * 1e9) + 1e9).toString(16);\n\t}\n}\n\n/**\n * Set up a matchMedia change event listener. Returns a function that, when\n * called, will remove the event listener again.\n *\n * @param {string} media\n * @param {(event: { matches: boolean }) => void} handler\n * @return {() => void}\n */\nexport function onMediaQueryMatch(media, handler) {\n\tvar mql = window.matchMedia(media);\n\n\tif (mql.addEventListener) {\n\t\tmql.addEventListener(\"change\", handler);\n\t} else {\n\t\tmql.addListener(handler);\n\t}\n\n\thandler(mql);\n\n\treturn function remove() {\n\t\tif (mql.addEventListener) {\n\t\t\tmql.removeEventListener(\"change\", handler);\n\t\t} else {\n\t\t\tmql.removeListener(handler);\n\t\t}\n\t};\n}\n\n/**\n * @param {HTMLElement} parent\n * @param {HTMLElement} child\n */\nexport function prependNode(parent, child) {\n\tvar children = parent.childNodes;\n\tif (children.length) parent.insertBefore(child, children[0]);\n\telse parent.appendChild(child);\n}\n\n/**\n * Set up a MutationObserver. Returns a disconnect function.\n * @param {() => void} handler\n * @param {HTMLElement | undefined} [root]\n * @return {undefined|() => void}\n */\nexport function onDomUpdate(handler, root) {\n\tif (\"MutationObserver\" in window) {\n\t\tvar observer = new MutationObserver(handler);\n\t\tobserver.observe(root || document, { childList: true, subtree: true });\n\t\treturn observer.disconnect.bind(observer);\n\t}\n}\n\n/**\n * Ponyfill for Element.prototype.closest.\n * @param {Element} element\n * @param {DOMString} selectors\n * @return {Element | null}\n */\nexport function closest(element, selectors) {\n\tif (Element.prototype.closest) {\n\t\treturn element.closest(selectors);\n\t}\n\tvar matches =\n\t\tElement.prototype.matches ||\n\t\tElement.prototype.msMatchesSelector ||\n\t\tElement.prototype.webkitMatchesSelector;\n\n\tdo {\n\t\tif (matches.call(element, selectors)) {\n\t\t\treturn element;\n\t\t}\n\t\telement = element.parentElement || element.parentNode;\n\t} while (element !== null && element.nodeType === 1);\n\n\treturn null;\n}\n"],"names":["initFormHelp","result","explanations","document","querySelectorAll","i","length","explanation","HTMLElement","previousSibling","previousElementSibling","tagName","querySelector","nextSibling","nextElementSibling","classList","contains","push","findCollapsibleExplanations","forEach","collapseExplanation","element","add","tabIndex","id","Math","random","toString","button","createElement","openLabel","dataset","closeLabel","iconOpenClasses","iconOpenClass","split","iconCloseClasses","iconCloseClass","apply","type","setAttribute","innerText","addEventListener","expand","getAttribute","remove","focus","parentNode","insertBefore","append","fn","readyState","onDomReady","handler","root","window","observer","MutationObserver","observe","childList","subtree","disconnect","bind","onDomUpdate"],"mappings":"gCAWO,SAASA,gBAOhB,WAcC,IAbA,IAAIC,OAAS,GACTC,aAAeC,SAASC,iBAC3B,8XAWQC,EAAI,EAAGA,EAAIH,aAAaI,OAAQD,IAAK,CAC7C,IAAIE,YAAcL,aAAaG,GAC/B,GAAME,uBAAuBC,YAA7B,CAGA,IAAIC,gBAAkBF,YAAYG,uBAClC,GAAMD,2BAA2BD,cAIJ,QAA5BC,gBAAgBE,SACfF,gBAAgBG,cAAc,4BAFhC,CAMA,IAAIC,YAAcN,YAAYO,mBAE3BD,uBAAuBL,aACD,WAAxBK,YAAYF,SACXE,YAAYE,UAAUC,SAAS,gBAEhCf,OAAOgB,KAAKV,eAGd,OAAON,QA5CPiB,GAA8BC,QAAQC,qBAkDvC,SAASA,oBAAoBb,aC/CtB,IAA4Bc,QDiDlCd,YAAYQ,UAAUO,IAAI,aAG1Bf,YAAYgB,UAAY,GCpDUF,QDqDfd,aCpDNiB,KACZH,QAAQG,GACPH,QAAQV,QAAU,KAAiC,OAAP,IAAhBc,KAAKC,WAAuBC,SAAS,KDqDnE,IAAIC,OAASzB,SAAS0B,cAAc,UAChCC,UAAYvB,YAAYwB,QAAQD,WAAa,cAC7CE,WAAazB,YAAYwB,QAAQC,YAAc,eAC/CC,iBACH1B,YAAYwB,QAAQG,eAAiB,0BACpCC,MAAM,OACJC,kBACH7B,YAAYwB,QAAQM,gBAAkB,mBACrCF,MAAM,OAERP,OAAOb,UAAUO,IAAI,eACrBM,OAAOb,UAAUO,IAAIgB,MAAMV,OAAOb,UAAWkB,iBAC7CL,OAAOW,KAAO,SACdX,OAAOY,aAAa,gBAAiB,SACrCZ,OAAOY,aAAa,gBAAiBjC,YAAYiB,IACjDI,OAAOa,UAAYX,UACnBF,OAAOc,iBAAiB,SAAS,WAChC,IAAIC,OAAkD,UAAzCf,OAAOgB,aAAa,iBACjChB,OAAOY,aAAa,gBAAiBG,OAAS,OAAS,SACvDf,OAAOb,UAAU8B,OAAOP,MACvBV,OAAOb,UACP4B,OAASV,gBAAkBG,kBAE5BR,OAAOb,UAAUO,IAAIgB,MACpBV,OAAOb,UACP4B,OAASP,iBAAmBH,iBAE7BL,OAAOa,UAAYE,OAASX,WAAaF,UACrCa,QACHpC,YAAYQ,UAAU8B,OAAO,aAC7BtC,YAAYuC,SAEZvC,YAAYQ,UAAUO,IAAI,gBAKxBf,YAAYM,YACfN,YAAYwC,WAAWC,aAAapB,OAAQrB,YAAYM,aAExDN,YAAYwC,WAAWE,OAAOrB,SC1GzB,SAAoBsB,IAC1B,GAA4B,YAAxB/C,SAASgD,WAA0B,OAAOD,KAC9C/C,SAASuC,iBAAiB,mBAAoBQ,KDH/CE,CAAWpD,cC8DJ,SAAqBqD,QAASC,MACpC,GAAI,qBAAsBC,OAAQ,CACjC,IAAIC,SAAW,IAAIC,iBAAiBJ,SACpCG,SAASE,QAAQJ,MAAQnD,SAAU,CAAEwD,WAAW,EAAMC,SAAS,IACxDJ,SAASK,WAAWC,KAAKN,WDjElCO,CAAY/D"}